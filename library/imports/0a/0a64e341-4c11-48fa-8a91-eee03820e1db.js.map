{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\lb_ysc\\Script/assets\\lb_ysc\\Script\\lb_ysc_sceneManager.js"],"names":["common","require","cc","Class","extends","Component","properties","maxLenght","isSound","isSoundEffect","audio_bg","url","AudioClip","default","audio_enter","audio_gameover","audio_win","audio_star","audio_write","audio_popbox","audio_click","onLoad","sm","game","addPersistRootNode","node","isWx","sysWx","levelIndex","isHelp","ud","getUserDate","audio_effect","getComponent","AudioSource","playAudioId","onLaunch","res","wx","getLaunchOptionsSync","console","log","query","level","loadLevel","parseInt","sys","platform","WECHAT_GAME","showShareMenu","withShareTicket","index","Math","floor","random","txt","shareTip","length","loader","loadRes","err","data","onShareAppMessage","title","imageUrl","success","fail","levels","director","loadScene","audioEffectPlay","name","clip","play","localStorage","getItem","JSON","parse","e","userDate","setUserDate","l","i","k","push","setItem","stringify","goToSelects","shareGame","shareAppMessage","homeBack"],"mappings":"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","file":"lb_ysc_sceneManager.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\lb_ysc\\Script","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\r\nvar common = require('lb_ysc_common');\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        maxLenght:0,//墨水值\r\n        isSound:true,\r\n        isSoundEffect:true,\r\n        audio_bg: {\r\n            url: cc.AudioClip,\r\n            default: null\r\n        },\r\n        audio_enter: {\r\n            url: cc.AudioClip,\r\n            default: null\r\n        },\r\n        audio_gameover: {\r\n            url: cc.AudioClip,\r\n            default: null\r\n        },\r\n        audio_win: {\r\n            url: cc.AudioClip,\r\n            default: null\r\n        },\r\n        audio_star: {\r\n            url: cc.AudioClip,\r\n            default: null\r\n        },\r\n        audio_write: {\r\n            url: cc.AudioClip,\r\n            default: null\r\n        },\r\n        audio_popbox: {\r\n            url: cc.AudioClip,\r\n            default: null\r\n        },\r\n        audio_click: {\r\n            url: cc.AudioClip,\r\n            default: null\r\n        }\r\n    \r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        common.sm = this;\r\n        //this.isGameTb = false;//是否从游戏进入\r\n        cc.game.addPersistRootNode(this.node);\r\n        this.isWx = this.sysWx();\r\n        this.levelIndex = 1;\r\n        this.isHelp = false;\r\n        this.ud = this.getUserDate();   \r\n        this.audio_effect = this.node.getComponent(cc.AudioSource);\r\n        this.playAudioId = null;\r\n        \r\n    },\r\n    //小游戏启动入口\r\n    onLaunch(){\r\n        if(this.isWx){\r\n            var res = wx.getLaunchOptionsSync();\r\n            console.log(res);\r\n            if(res.query){\r\n                \r\n                if(res.query.level){\r\n                    this.isHelp = true;\r\n                    this.loadLevel(parseInt(res.query.level));\r\n                }\r\n            }\r\n        }\r\n    },\r\n    sysWx(){\r\n        if(cc.sys.platform == cc.sys.WECHAT_GAME){\r\n            //1.显示当前页面的转发按钮\r\n            wx.showShareMenu({withShareTicket:true});\r\n            //2.监听:分享接口 \r\n            var index = Math.floor(Math.random()*3+1);\r\n            var txt = Math.floor(Math.random()*common.shareTip.length);\r\n            var url = \"lb_ysc/lb_ysc_df\"+index;\r\n            cc.loader.loadRes(url,(err,data)=>{\r\n                wx.onShareAppMessage((res)=>{\r\n                    return {\r\n                        title: common.shareTip[txt],\r\n                        imageUrl: data.url,\r\n                        success(res){\r\n                            console.log(res)\r\n                        },\r\n                        fail(res){\r\n                            console.log(res)\r\n                        } \r\n                    }\r\n                })\r\n            }); \r\n            return true;\r\n        }else{\r\n            return false;\r\n        }\r\n    },\r\n    loadLevel(index){\r\n        if(index > common.levels.length){\r\n            console.log('最后一关');\r\n            return;\r\n        }\r\n        this.levelIndex = index;\r\n        cc.director.loadScene('lb_ysc_level');\r\n    },\r\n    // update (dt) {},\r\n\r\n    //音效播放\r\n    audioEffectPlay(name){\r\n        if(this.isSoundEffect){\r\n            this.audio_effect.clip = name;\r\n            this.audio_effect.play();\r\n        }\r\n        \r\n    },\r\n    \r\n    getUserDate:function(){//获取用户数据\r\n        \r\n        // if (this.isWx) {\r\n        //     try {\r\n        //         var data = JSON.parse(wx.getStorageSync('lb_userdate'));\r\n        //     } catch (e) {\r\n        //         console.log(\"用户数据获取出错!\");    \r\n        //     }\r\n        // }else{\r\n        //     var data = JSON.parse(window.localStorage.getItem('lb_userdate'));\r\n        // }\r\n        var data = cc.sys.localStorage.getItem(\"lb_ysc_userdate\");\r\n        try{\r\n            data = JSON.parse(data);\r\n        }catch(e){\r\n            console.log(e);\r\n\r\n        }\r\n        console.log(\"data:\",data);\r\n        if(data == null || data == ''){//如果为空返回默认数据，并保存\r\n            data = common.userDate;\r\n            data.levels = common.levels;\r\n            this.setUserDate(data);\r\n        }\r\n        var l = data.levels.length;\r\n        var i = common.levels.length - l;\r\n        if(i>0){\r\n            for(var k=0; k<i; k++){\r\n                data.levels.push(common.levels[l+k]);\r\n            }\r\n        }\r\n        console.log(data);\r\n        \r\n        return data;\r\n    },\r\n    setUserDate:function(data){//保存用户数据\r\n        cc.sys.localStorage.setItem(\"lb_ysc_userdate\", JSON.stringify(data));\r\n        // if (this.isWx) {\r\n        //     try {\r\n        //         wx.setStorageSync('lb_userdate', JSON.stringify(data));\r\n        //     } catch (e) {\r\n        //         console.log(\"用户数据保存出错!\");    \r\n        //     }\r\n        // }else{\r\n        //     window.localStorage.setItem('lb_userdate',JSON.stringify(data));\r\n        // }\r\n        \r\n    },\r\n    goToSelects(){\r\n        cc.director.loadScene('lb_ysc_select');\r\n    },\r\n    shareGame(){\r\n        if(common.sm.isWx){\r\n            var index = Math.floor(Math.random()*3+1);\r\n            var txt = Math.floor(Math.random()*common.shareTip.length);\r\n            var url = \"lb_ysc/lb_ysc_df\"+index;\r\n            \r\n            cc.loader.loadRes(url,function(err,data){\r\n                console.log(data.url);\r\n                wx.shareAppMessage({\r\n                    title:common.shareTip[txt],\r\n                    imageUrl:data.url\r\n                })\r\n            });\r\n            \r\n        }\r\n        \r\n    },\r\n    //双双返回\r\n    homeBack(){\r\n        cc.director.loadScene('common');//返回\r\n    }\r\n    \r\n    \r\n});\r\n"]}
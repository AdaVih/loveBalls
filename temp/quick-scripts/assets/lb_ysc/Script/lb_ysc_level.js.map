{"version":3,"sources":["lb_ysc_level.js"],"names":["common","require","cc","Class","extends","Component","properties","select_level_bar","default","type","Node","level_bar","total_star","selectLevels","levels","onLoad","start","loadRes","loader","err","prefab","itemPrefab","item2Prefab","listPrefab","loadSceneDate","level_page","levelPack","pageCount","Math","ceil","length","bar_width","winSize","width","list2","instantiate","addChild","load_item_count","createLevelBarItem","levelDate","page_all","page_load_index","load_count","createLevelVessel","createItem","bar","item","on","EventType","TOUCH_START","touch_star","isTouch","TOUCH_END","e","audioEngine","playEffect","sm","audio_click","par","target","parent","getSiblingIndex","index","ud","active","pageIndex","loadLevel","loadUserData","update","dt","itemdate","end","star_count","star","getChildByName","getComponent","Label","Skinpop_BG","img","mask","id","string","event","goToLevels","list","push","count","i","ScrollView","scrollToLeft","data","allLevelCombine","isGameTb","undefined","console","log","PageView","setCurrentPageIndex","getStarCount","alllevels","forEach","element","loadItem","children","cur","slice","pass","all_star_count","isPass","isMsak","k","j","img_url","SpriteFrame","tex","Sprite","spriteFrame","release","addExpectation","page","level","bars","star1","star2","star3","back","director","loadScene","share","shareGame"],"mappings":"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","file":"lb_ysc_level.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\lb_ysc\\Script","sourcesContent":["\r\nvar common = require('lb_ysc_common');\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        select_level_bar:{//场景分类选择面板\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        level_bar:{//场景关卡\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        total_star:{//总星星\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        selectLevels:{\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        levels:{\r\n            default: null,\r\n            type: cc.Node,\r\n        }\r\n    },\r\n\r\n\r\n    onLoad () {\r\n        \r\n    },\r\n    start () {\r\n        // common.sm.audio.play();\r\n        // common.sm.audio.setCurrentTime(common.sm.audio_time||0);\r\n        //加载资源\r\n        this.loadRes();\r\n    },\r\n    loadRes(){\r\n        cc.loader.loadRes('lb_ysc/prefab/lb_ysc_item',(err, prefab)=> {\r\n            this.itemPrefab = prefab;\r\n            cc.loader.loadRes('lb_ysc/prefab/lb_ysc_item2',(err, prefab)=> {\r\n                this.item2Prefab = prefab;\r\n                cc.loader.loadRes('lb_ysc/prefab/lb_ysc_list',(err, prefab)=> {\r\n                    this.listPrefab = prefab;\r\n                    this.loadSceneDate();\r\n                });\r\n            });\r\n        });\r\n        \r\n        \r\n    },\r\n\r\n\r\n    //读取场景数据\r\n    loadSceneDate(){\r\n        \r\n        this.level_page = [];\r\n        this.levelPack();\r\n        \r\n    },\r\n\r\n    //levels打包\r\n    levelPack(){\r\n        this.pageCount = Math.ceil(common.levels.length/12);//计算有多少item\r\n        var bar_width = Math.ceil(this.pageCount/2) * cc.winSize.width;//计算bar长度\r\n        this.select_level_bar.width = bar_width;\r\n        cc.loader.loadRes('lb_ysc/prefab/lb_ysc_list2',(err, prefab)=> {\r\n            var list2 = cc.instantiate(prefab);\r\n            list2.width = bar_width;\r\n            this.select_level_bar.addChild(list2);\r\n\r\n            this.load_item_count = 0;\r\n            this.createLevelBarItem(list2);\r\n            this.levelDate();\r\n        });\r\n    },\r\n\r\n    //levelDate读取\r\n    levelDate(){\r\n        this.page_all = Math.ceil(common.levels.length/6);//计算有多少item\r\n        //this.level_bar.width = this.page_all * cc.winSize.width;\r\n        this.page_load_index = 0;\r\n        this.load_count = 0;//已经加载统计\r\n        this.createLevelVessel();\r\n    },\r\n\r\n\r\n    //创建场景节点\r\n    createItem(bar){ \r\n        this.load_count++;\r\n        var item = cc.instantiate(this.itemPrefab);\r\n        bar.addChild(item);\r\n        item.on(cc.Node.EventType.TOUCH_START,function(){\r\n            this.touch_star = 0;\r\n            this.isTouch = true;\r\n        },this);\r\n        item.on(cc.Node.EventType.TOUCH_END,function(e){\r\n            cc.audioEngine.playEffect(common.sm.audio_click, false);\r\n            var par = e.target.parent.getSiblingIndex() * 6;\r\n            var index = e.target.getSiblingIndex() + 1 + par;\r\n            if(common.sm.ud.levels[index-1].active){\r\n                common.sm.pageIndex = e.target.parent.getSiblingIndex();\r\n                common.sm.loadLevel(index);\r\n            }\r\n        },this);\r\n        if(this.load_count == common.levels.length){//表示加载完毕\r\n            this.loadUserData();\r\n        }\r\n    },\r\n    update (dt) {\r\n        if(this.isTouch){\r\n            this.touch_star++;\r\n        }\r\n    },\r\n    \r\n    //创建levels打包\r\n    createLevelBarItem(bar,itemdate){ \r\n        this.load_item_count++;\r\n\r\n        if(this.load_item_count == this.pageCount){\r\n            var start = ((this.load_item_count-1)*12)+1;\r\n            var end = common.levels.length;\r\n        }else{\r\n            var end = (this.load_item_count*12);\r\n            var start = end-12+1;\r\n        }\r\n        var star_count = (end - start + 1)*3;\r\n        var item = cc.instantiate(this.item2Prefab);\r\n        var star = item.getChildByName('star').getChildByName('star_count').getComponent(cc.Label);\r\n        var Skinpop_BG = item.getChildByName('Skinpop_BG');\r\n        var img = Skinpop_BG.getChildByName('level_img');//图片\r\n        var mask = img.getChildByName('mask');//遮罩\r\n        var id = img.getChildByName('id').getComponent(cc.Label);\r\n        star.string = 0 + '/' + star_count;\r\n        id.string = start + '-' + end;\r\n        bar.addChild(item);\r\n        item.on(cc.Node.EventType.TOUCH_START,function(event){\r\n            this.touch_star = 0;\r\n            this.isTouch = true;\r\n        },this);\r\n        item.on(cc.Node.EventType.TOUCH_END,this.goToLevels,this);\r\n        if(this.pageCount == this.load_item_count){\r\n            return;\r\n        }else{\r\n            this.createLevelBarItem(bar);\r\n        }\r\n    },\r\n\r\n    //创建level容器\r\n    createLevelVessel(){\r\n        var list = cc.instantiate(this.listPrefab);\r\n        list.width = cc.winSize.width;\r\n        // list.x = this.page_load_index*cc.winSize.width;\r\n        this.level_page.push(list);\r\n        this.level_bar.addChild(list);\r\n\r\n        this.page_load_index ++;\r\n        if(this.page_all == this.page_load_index){\r\n            var count = common.levels.length - this.load_count;\r\n        }else{\r\n            var count = 6;\r\n        }\r\n        for(var i=0; i<count; i++){\r\n            this.createItem(list);\r\n        }\r\n        if(this.page_all == this.page_load_index){\r\n            return;\r\n        }else{\r\n            this.selectLevels.getComponent(cc.ScrollView).scrollToLeft(0.01);\r\n            this.createLevelVessel();\r\n            \r\n        }\r\n    },\r\n    //读取用户数据\r\n    loadUserData(){\r\n        var data = common.sm.ud;\r\n        this.allLevelCombine();\r\n        if(common.sm.isGameTb){\r\n            this.selectLevels.active = false;\r\n            this.levels.active = true;\r\n            if(common.sm.pageIndex != undefined){\r\n                console.log(common.sm.pageIndex);\r\n                this.levels.getComponent(cc.PageView).setCurrentPageIndex(common.sm.pageIndex);\r\n            }    \r\n        }\r\n        \r\n        if(data){\r\n            this.total_star.getComponent(cc.Label).string = this.getStarCount();\r\n            if(this.alllevels){\r\n                data.levels.forEach((element,index)=>{\r\n                    this.loadItem(this.alllevels[index],element);\r\n                });\r\n                //遍历集合\r\n                var bar = this.select_level_bar.children[0].children;\r\n                if(bar){\r\n                    bar.forEach((e,index)=>{\r\n                        var i = index+1;\r\n                        if(i == bar.length){\r\n                            var start = ((i-1)*12);\r\n                            var end = common.levels.length;\r\n                        }else{\r\n                            var end = (i*12);\r\n                            var start = end-12;\r\n                        }\r\n                        var cur = data.levels.slice(start,end);\r\n                        var Skinpop_BG = e.getChildByName('Skinpop_BG');\r\n                        var img = Skinpop_BG.getChildByName('level_img');//图片\r\n                        var mask = img.getChildByName('mask');//遮罩\r\n                        var pass = img.getChildByName('pass');//通过\r\n                        var star = e.getChildByName('star').getChildByName('star_count').getComponent(cc.Label);//星星数量\r\n                        var star_count = 0;\r\n                        var all_star_count = 0;\r\n                        var isPass = false;\r\n                        var isMsak = false;\r\n                        var count = 0;\r\n                        cur.forEach((k,j)=>{\r\n                            star_count += k.star;\r\n                            if(k.active){\r\n                                isMsak = true;\r\n                            }\r\n                            if(k.pass){\r\n                                count++;\r\n                            }\r\n                            if(count == cur.length){\r\n                                isPass = true;\r\n                            }\r\n                            all_star_count += 3;\r\n                        });\r\n                        star.string = star_count + '/' + all_star_count;\r\n                        mask.active = !isMsak;\r\n                        pass.active = isPass;\r\n                        var img_url = \"lb_ysc/levels_img/lb_ysc_level\"+cur[0].id;\r\n                        cc.loader.loadRes(img_url,cc.SpriteFrame, (err, tex)=>{\r\n                            //var spriteFrame = new cc.SpriteFrame(tex);\r\n                            if(tex){\r\n                                img.getComponent(cc.Sprite).spriteFrame = tex;\r\n                                cc.loader.release(tex);        \r\n                            }\r\n                                             \r\n                        });\r\n                    });\r\n                }\r\n            }\r\n        }\r\n        //添加敬请期待item\r\n        this.addExpectation();\r\n    },\r\n    //添加敬请期待item\r\n    addExpectation(){\r\n        var page = cc.instantiate(this.item2Prefab);\r\n        this.select_level_bar.getChildByName('list2').addChild(page);\r\n        var level = cc.instantiate(this.itemPrefab);\r\n        if(common.sm.ud.levels.length%12 == 0){\r\n            var level = cc.instantiate(this.listPrefab);\r\n            this.level_bar.addChild(list);\r\n            list.addChild(level);\r\n        }else{\r\n            var list = this.level_bar.children;\r\n            if(list){\r\n                list[list.length-1].addChild(level);\r\n            }\r\n        }\r\n        \r\n    },\r\n    //把所有LEVEL合并为一个数组\r\n    allLevelCombine(){\r\n        this.alllevels = [];\r\n        var bars = this.level_bar.children;\r\n        bars.forEach(element => {\r\n            var list = element.children;\r\n            list.forEach(element => {\r\n                this.alllevels.push(element);\r\n            });\r\n        });\r\n    },\r\n    //为每个item读取数据\r\n    loadItem(item,data){\r\n        var Skinpop_BG = item.getChildByName('Skinpop_BG');\r\n        var img = Skinpop_BG.getChildByName('level_img');//图片\r\n        var mask = img.getChildByName('mask');//遮罩\r\n        var pass = img.getChildByName('pass');//通过\r\n        var id = img.getChildByName('id').getComponent(cc.Label);//id\r\n        var star1 = item.getChildByName('star_bg1').getChildByName('star');//星星\r\n        var star2 = item.getChildByName('star_bg2').getChildByName('star');//星星\r\n        var star3 = item.getChildByName('star_bg3').getChildByName('star');//星星\r\n        mask.active = !data.active;\r\n        pass.active = data.pass;\r\n        id.string = data.id<10?('0'+data.id):data.id;\r\n        if(data.star >= 1){\r\n            star1.active = true;\r\n        }\r\n        if(data.star >= 2){\r\n            star2.active = true;\r\n        }\r\n        if(data.star >= 3){\r\n            star3.active = true;\r\n        }\r\n        var img_url = \"lb_ysc/levels_img/lb_ysc_level\"+data.id;\r\n        cc.loader.loadRes(img_url,cc.SpriteFrame, (err, tex)=>{\r\n            //var spriteFrame = new cc.SpriteFrame(tex);\r\n            if(tex){\r\n                img.getComponent(cc.Sprite).spriteFrame = tex;\r\n                cc.loader.release(tex); \r\n            }\r\n                                    \r\n        });\r\n    },\r\n    \r\n    //计算获得的总星星数\r\n    getStarCount(){\r\n        var star = 0;\r\n        common.sm.ud.levels.forEach(e=>{\r\n            star += e.star;\r\n        });\r\n        return star;\r\n    },\r\n    //调到当前集合下\r\n    goToLevels(e){\r\n        cc.audioEngine.playEffect(common.sm.audio_click, false);\r\n        console.log(e);\r\n        this.isTouch = false;\r\n        if(this.touch_star < 30){\r\n            this.selectLevels.active = false;\r\n            this.levels.active = true;\r\n            var index = e.target.getSiblingIndex();\r\n            \r\n            this.levels.getComponent(cc.PageView).setCurrentPageIndex(2*index);\r\n            //调到当前页\r\n           // this.level_bar.x = page*cc.winSize.width;\r\n            \r\n        }\r\n    },\r\n    //返回关卡分组\r\n    back(e){\r\n        \r\n        cc.audioEngine.playEffect(common.sm.audio_click, false);\r\n        if(this.selectLevels.active){\r\n            cc.director.loadScene('lb_ysc_Opening'); \r\n        }else{\r\n            common.sm.isGameTb = false;\r\n            cc.director.loadScene('lb_ysc_select');\r\n        }\r\n             \r\n    },\r\n    share(){\r\n        common.sm.shareGame();\r\n    }\r\n});\r\n"]}
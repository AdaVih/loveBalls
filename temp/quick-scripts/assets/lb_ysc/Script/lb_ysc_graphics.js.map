{"version":3,"sources":["lb_ysc_graphics.js"],"names":["common","require","cc","Class","extends","Component","properties","maxLenght","scor_star1","default","type","Node","scor_star2","scor_star3","Canvas","pen","score_text","onLoad","sm","start","index","gm","level","active","url","loader","loadRes","err","prefab","instantiate","level_node","addChild","boyRigidBody","getChildByName","grilRigidBody","gameTip","init","update","dt","pen_speed","penState","speed","drawLenght","event_id","is_scor_star1","is_scor_star2","is_scor_star3","score","getComponent","Label","score_val","parseInt","string","schedule_val","schedule_bar","width","graphics","Graphics","RigidBody","gravityScale","on","EventType","TOUCH_START","touchStar","TOUCH_MOVE","touchMove","TOUCH_END","event","getID","touchEnd","TOUCH_CANCEL","direction","pointbox","addPolygonCollider","points","length","p1","p2","d","Math","sqrt","x","y","p_collider","boxNode","addComponent","PhysicsPolygonCollider","apply","e","addCollider","rigidbody","RigidBodyType","Dynamic","forEach","element","lineWidth","strokeColor","hexToColor","i","moveTo","startPos","lineTo","stroke","group","console","log","isDraw","isStop","Color","node","convertToNodeSpaceAR","parent","convertToWorldSpaceAR","getLocation","Animation","stop","play","curpoint","push","p","getPreviousLocation","rayresults","director","getPhysicsManager","rayCast","RayCastType","Any","objOutP","ray","point","cur_p","starUp","incisionLine","audio_effect","isPlaying","audioEffectPlay","audio_write","cur_p1","cur_d","clear","get_star3","starHide","get_star2","get_star1","star","ani","star_low","star_lowPrefab","GetSlideAngle","dx","dy","atan2","PI","GetSlideDirection","startX","startY","endX","endY","result","angle","addx","addy","rex","rey"],"mappings":";;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA,IAAIA,SAASC,QAAQ,eAAR,CAAb;AACAC,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC;AACIC,mBAAU,CADd;AAEIC,oBAAW,EAAC;AACRC,qBAAS,IADF;AAEPC,kBAAMR,GAAGS;AAFF,SAFf;AAMIC,oBAAW,EAAC;AACRH,qBAAS,IADF;AAEPC,kBAAMR,GAAGS;AAFF,SANf;AAUIE,oBAAW,EAAC;AACRJ,qBAAS,IADF;AAEPC,kBAAMR,GAAGS;AAFF,SAVf;AAcIG,gBAAO;AACHL,qBAAS,IADN;AAEHC,kBAAMR,GAAGS;AAFN,SAdX;AAkBII,aAAI;AACAN,qBAAS,IADT;AAEAC,kBAAMR,GAAGS;AAFT,SAlBR;AAsBIK,oBAAW;AACPP,qBAAS,IADF;AAEPC,kBAAMR,GAAGS;AAFF;AAtBf,kDA0Be;AACPF,iBAAS,IADF;AAEPC,cAAMR,GAAGS;AAFF,KA1Bf,gDA8BiB;AACTF,iBAAS,IADA;AAETC,cAAMR,GAAGS;AAFA,KA9BjB,eAHK;;AAuCL;;AAEAM,UAzCK,oBAyCK;AACN;AACA,aAAKV,SAAL,GAAiBP,OAAOkB,EAAP,CAAUX,SAA3B;AAEH,KA7CI;AA8CLY,SA9CK,mBA8CI;AAAA;;AACL;AACA,YAAIC,QAAQpB,OAAOqB,EAAP,CAAUC,KAAtB;AACA,YAAGF,SAAS,CAAZ,EAAc;AACV,iBAAKL,GAAL,CAASQ,MAAT,GAAkB,IAAlB;AACH;AACD,YAAIC,MAAM,+BAA6BJ,KAAvC;AACAlB,WAAGuB,MAAH,CAAUC,OAAV,CAAkBF,GAAlB,EAAuB,UAACG,GAAD,EAAMC,MAAN,EAAgB;AACnC,gBAAGA,MAAH,EAAU;AACN,oBAAIN,QAAQpB,GAAG2B,WAAH,CAAeD,MAAf,CAAZ;AACA5B,uBAAOqB,EAAP,CAAUS,UAAV,CAAqBC,QAArB,CAA8BT,KAA9B;AACAtB,uBAAOqB,EAAP,CAAUW,YAAV,GAAyBV,MAAMW,cAAN,CAAqB,KAArB,CAAzB;AACAjC,uBAAOqB,EAAP,CAAUa,aAAV,GAA0BZ,MAAMW,cAAN,CAAqB,MAArB,CAA1B;AACAjC,uBAAOqB,EAAP,CAAUc,OAAV,GAAoBb,MAAMW,cAAN,CAAqB,KAArB,CAApB;AACA,sBAAKG,IAAL;AACH;AACJ,SATD;AAYH,KAjEI;AAmELC,UAnEK,kBAmEGC,EAnEH,EAmEO;;AAER,YAAG,KAAKC,SAAL,GAAiB,CAApB,EAAsB;;AAElB,iBAAKA,SAAL;AACA,gBAAG,KAAKA,SAAL,GAAiB,CAApB,EAAsB;AAClB,qBAAKA,SAAL,GAAiB,CAAjB;AACH;AACD,gBAAG,KAAKC,QAAR,EACA,KAAKA,QAAL,CAAcC,KAAd,GAAsB,KAAKF,SAA3B;AACH;AACJ,KA9EI;AA+ELH,QA/EK,kBA+EC;AACF,aAAKM,UAAL,GAAkB,CAAlB;;AAEA,aAAKC,QAAL,GAAgB,IAAhB;AACA,aAAKC,aAAL,GAAqB,IAArB;AACA,aAAKC,aAAL,GAAqB,IAArB;AACA,aAAKC,aAAL,GAAqB,IAArB;AACA;AACA,aAAKP,SAAL,GAAiB,CAAjB;AACA;AACA,aAAKQ,KAAL,GAAa,KAAK/B,UAAL,CAAgBgC,YAAhB,CAA6B9C,GAAG+C,KAAhC,CAAb;AACA,aAAKC,SAAL,GAAiBC,SAAS,KAAKJ,KAAL,CAAWK,MAApB,CAAjB;AACA;AACA,aAAKC,YAAL,GAAoB,KAAKC,YAAL,CAAkBC,KAAtC;AACA;AACA,aAAKC,QAAL,GAAgB,KAAKR,YAAL,CAAkB9C,GAAGuD,QAArB,CAAhB;;AAGA,aAAKzB,YAAL,GAAoBhC,OAAOqB,EAAP,CAAUW,YAAV,CAAuBgB,YAAvB,CAAoC9C,GAAGwD,SAAvC,CAApB;AACA,aAAKxB,aAAL,GAAqBlC,OAAOqB,EAAP,CAAUa,aAAV,CAAwBc,YAAxB,CAAqC9C,GAAGwD,SAAxC,CAArB;AACA,aAAK1B,YAAL,CAAkB2B,YAAlB,GAAiC,CAAjC;AACA,aAAKzB,aAAL,CAAmByB,YAAnB,GAAkC,CAAlC;;AAEA;AACA,aAAKhB,QAAL,GAAgB3C,OAAOkB,EAAP,CAAUyB,QAA1B;AACA,aAAK7B,MAAL,CAAY8C,EAAZ,CAAe1D,GAAGS,IAAH,CAAQkD,SAAR,CAAkBC,WAAjC,EAA6C,KAAKC,SAAlD,EAA4D,IAA5D;AACA,aAAKjD,MAAL,CAAY8C,EAAZ,CAAe1D,GAAGS,IAAH,CAAQkD,SAAR,CAAkBG,UAAjC,EAA4C,KAAKC,SAAjD,EAA2D,IAA3D;AACA,aAAKnD,MAAL,CAAY8C,EAAZ,CAAe1D,GAAGS,IAAH,CAAQkD,SAAR,CAAkBK,SAAjC,EAA2C,UAASC,KAAT,EAAe;AACtD,iBAAKpD,GAAL,CAASQ,MAAT,GAAkB,KAAlB;AACA;AACA;AACA;AACA;AACA;AACA,gBAAG,KAAKoB,QAAL,IAAiBwB,MAAMC,KAAN,EAApB,EAAkC;AAC9B;AACH;AACD,iBAAKzB,QAAL,GAAgB,IAAhB;AACA,iBAAK0B,QAAL;AACH,SAZD,EAYE,IAZF;AAaA,aAAKvD,MAAL,CAAY8C,EAAZ,CAAe1D,GAAGS,IAAH,CAAQkD,SAAR,CAAkBS,YAAjC,EAA8C,UAASH,KAAT,EAAe;AACzD,iBAAKpD,GAAL,CAASQ,MAAT,GAAkB,KAAlB;AACA;AACA;AACA;AACA;AACA;AACA,gBAAG,KAAKoB,QAAL,IAAiBwB,MAAMC,KAAN,EAApB,EAAkC;AAC9B;AACH;AACD,iBAAKzB,QAAL,GAAgB,IAAhB;AACA,iBAAK0B,QAAL;AACH,SAZD,EAYE,IAZF;;AAcA,aAAKE,SAAL,GAAiB,CAAjB,CAtDE,CAsDiB;AACnB;AACA,aAAKC,QAAL,GAAgB,EAAhB;AAEH,KAzII;AA6ILC,sBA7IK,8BA6IcC,MA7Id,EA6IqB;AACtB,YAAGA,OAAOC,MAAP,GAAgB,CAAnB,EAAqB;AACjB,gBAAG;AACC,oBAAIC,KAAKF,OAAO,CAAP,CAAT;AACA,oBAAIG,KAAKH,OAAOA,OAAOC,MAAP,GAAc,CAArB,CAAT;AACA,oBAAIG,IAAIC,KAAKC,IAAL,CAAU,CAACJ,GAAGK,CAAH,GAAKJ,GAAGI,CAAT,KAAaL,GAAGK,CAAH,GAAKJ,GAAGI,CAArB,IAA0B,CAACL,GAAGM,CAAH,GAAKL,GAAGK,CAAT,KAAaN,GAAGM,CAAH,GAAKL,GAAGK,CAArB,CAApC,CAAR;AACA,oBAAGJ,IAAE,CAAL,EAAO;AACH,wBAAIK,aAAa,KAAKC,OAAL,CAAaC,YAAb,CAA0BnF,GAAGoF,sBAA7B,CAAjB,CADG,CACmE;AACtEH,+BAAWT,MAAX,GAAoBA,MAApB;AACAS,+BAAWI,KAAX;AACH;AACJ,aATD,CASC,OAAMC,CAAN,EAAQ,CAER;AAEJ;AAEJ,KA9JI;AAgKLC,eAhKK,uBAgKOf,MAhKP,EAgKc;AAAA;;AACf,YAAG,KAAKF,QAAL,CAAcG,MAAd,GAAuB,CAA1B,EAA4B;AACxB,iBAAKS,OAAL,GAAe,IAAIlF,GAAGS,IAAP,EAAf;AACA,gBAAI+E,YAAY,KAAKN,OAAL,CAAaC,YAAb,CAA0BnF,GAAGwD,SAA7B,CAAhB;AACAgC,sBAAUhF,IAAV,GAAiBR,GAAGyF,aAAH,CAAiBC,OAAlC;AACAF,sBAAU/B,YAAV,GAAyB,EAAzB;;AAGA;AACA;AACA;AACA,gBAAG,KAAKa,QAAR,EAAiB;AACb,qBAAKA,QAAL,CAAcqB,OAAd,CAAsB,UAACC,OAAD,EAAS1E,KAAT,EAAmB;AACrC,2BAAKqD,kBAAL,CAAwBqB,OAAxB;AACH,iBAFD;AAGH;;AAED,gBAAItC,WAAW,KAAK4B,OAAL,CAAaC,YAAb,CAA0BnF,GAAGuD,QAA7B,CAAf;AACAD,qBAASuC,SAAT,GAAqB,CAArB;AACAvC,qBAASwC,WAAT,GAAuB9F,GAAG+F,UAAH,CAAc,SAAd,CAAvB;;AAEA,iBAAI,IAAIC,IAAE,CAAV,EAAaA,IAAExB,OAAOC,MAAtB,EAA8BuB,GAA9B,EAAkC;AAC9B,oBAAGA,KAAK,CAAR,EAAU;AACN1C,6BAAS2C,MAAT,CAAgB,KAAKC,QAAL,CAAcnB,CAA9B,EAAiC,KAAKmB,QAAL,CAAclB,CAA/C;AACH;AACD1B,yBAAS6C,MAAT,CAAgB3B,OAAOwB,CAAP,EAAUjB,CAA1B,EAA6BP,OAAOwB,CAAP,EAAUhB,CAAvC;AAEH;AACD1B,qBAAS8C,MAAT;AACA,iBAAKlB,OAAL,CAAamB,KAAb,GAAqB,aAArB;AACAvG,mBAAOqB,EAAP,CAAUS,UAAV,CAAqBC,QAArB,CAA8B,KAAKqD,OAAnC;AACA,iBAAKZ,QAAL,GAAgB,EAAhB;AACH;AAKJ,KArMI;;;AAwML;AACAT,aAzMK,qBAyMKI,KAzML,EAyMW;AACZqC,gBAAQC,GAAR,CAAY,YAAZ,EAAyBtC,MAAMC,KAAN,EAAzB;AACA,YAAG,KAAKzB,QAAL,IAAiB,IAApB,EAAyB;AACrB,iBAAKA,QAAL,GAAgBwB,MAAMC,KAAN,EAAhB;AACH,SAFD,MAEK;AACD,gBAAG,KAAKzB,QAAL,IAAiBwB,MAAMC,KAAN,EAApB,EAAkC;AAC9B;AACH;AACJ;AACD;;AAEA,YAAGpE,OAAOqB,EAAP,CAAUqF,MAAb,EAAoB;AAChB1G,mBAAOqB,EAAP,CAAUsF,MAAV,GAAmB,KAAnB;AACA,iBAAKnD,QAAL,CAAcwC,WAAd,GAA4B,IAAI9F,GAAG0G,KAAP,CAAa,CAAb,EAAe,CAAf,EAAiB,CAAjB,CAA5B;AACA,iBAAKR,QAAL,GAAgB,KAAKS,IAAL,CAAUC,oBAAV,CAA+B,KAAKhG,MAAL,CAAYiG,MAAZ,CAAmBC,qBAAnB,CAAyC7C,MAAM8C,WAAN,EAAzC,CAA/B,CAAhB;;AAEA,iBAAKlG,GAAL,CAASkE,CAAT,GAAa,KAAKmB,QAAL,CAAcnB,CAA3B;AACA,iBAAKlE,GAAL,CAASmE,CAAT,GAAa,KAAKkB,QAAL,CAAclB,CAA3B;AACA,iBAAKnE,GAAL,CAASQ,MAAT,GAAkB,IAAlB;AACAvB,mBAAOqB,EAAP,CAAUc,OAAV,CAAkBZ,MAAlB,GAA2B,KAA3B;AACA,iBAAKR,GAAL,CAASiC,YAAT,CAAsB9C,GAAGgH,SAAzB,EAAoCC,IAApC;AACA,iBAAK3E,QAAL,GAAgB,KAAKzB,GAAL,CAASiC,YAAT,CAAsB9C,GAAGgH,SAAzB,EAAoCE,IAApC,CAAyC,gBAAzC,CAAhB;AACApH,mBAAOqB,EAAP,CAAUqD,MAAV,GAAmB,EAAnB;AACA;AACA,iBAAK2C,QAAL,GAAgB,EAAhB;AACA,iBAAKA,QAAL,CAAcC,IAAd,CAAmBpH,GAAGqH,CAAH,CAAK,KAAKnB,QAAL,CAAcnB,CAAnB,EAAqB,KAAKmB,QAAL,CAAclB,CAAnC,CAAnB;AACA,iBAAK1B,QAAL,CAAc2C,MAAd,CAAqB,KAAKC,QAAL,CAAcnB,CAAnC,EAAsC,KAAKmB,QAAL,CAAclB,CAApD;AAEH;AAEJ,KAvOI;;;AAyOL;AACAjB,aA1OK,qBA0OKE,KA1OL,EA0OW;AACZ;AACA;AACA,YAAG,KAAKxB,QAAL,IAAiBwB,MAAMC,KAAN,EAApB,EAAkC;AAC9B;AACH;AACD,YAAGpE,OAAOqB,EAAP,CAAUqF,MAAb,EAAoB;AAChB,gBAAI9B,KAAK,KAAKiC,IAAL,CAAUC,oBAAV,CAA+B,KAAKhG,MAAL,CAAYiG,MAAZ,CAAmBC,qBAAnB,CAAyC7C,MAAMqD,mBAAN,EAAzC,CAA/B,CAAT;AACA,gBAAI3C,KAAK,KAAKgC,IAAL,CAAUC,oBAAV,CAA+B,KAAKhG,MAAL,CAAYiG,MAAZ,CAAmBC,qBAAnB,CAAyC7C,MAAM8C,WAAN,EAAzC,CAA/B,CAAT;;AAEA;AACA,iBAAKlG,GAAL,CAASkE,CAAT,GAAaJ,GAAGI,CAAhB;AACA,iBAAKlE,GAAL,CAASmE,CAAT,GAAaL,GAAGK,CAAhB;;AAMA,gBAAG,KAAK3C,SAAL,GAAe,CAAlB,EAAoB;AAChB,qBAAKA,SAAL,IAAgB,CAAhB;AACH;;AAGD,gBAAGvC,OAAOqB,EAAP,CAAUsF,MAAV,IAAoB,KAAvB,EAA6B;AACzB,oBAAIc,aAAavH,GAAGwH,QAAH,CAAYC,iBAAZ,GAAgCC,OAAhC,CAAwC1H,GAAGqH,CAAH,CAAK,KAAKzG,MAAL,CAAYiG,MAAZ,CAAmBC,qBAAnB,CAAyC7C,MAAMqD,mBAAN,EAAzC,CAAL,CAAxC,EAChBtH,GAAGqH,CAAH,CAAK,KAAKzG,MAAL,CAAYiG,MAAZ,CAAmBC,qBAAnB,CAAyC7C,MAAM8C,WAAN,EAAzC,CAAL,CADgB,EACqD/G,GAAG2H,WAAH,CAAeC,GADpE,CAAjB;AAEA;AACA,oBAAGL,WAAW9C,MAAX,GAAoB,CAAvB,EAAyB;AACrB3E,2BAAOqB,EAAP,CAAUsF,MAAV,GAAmB,IAAnB;AACH,iBAFD,MAEK;AACD,wBAAG3G,OAAOqB,EAAP,CAAU0G,OAAb,EAAqB;AACjB,4BAAIR,IAAI,KAAKV,IAAL,CAAUC,oBAAV,CAA+B9G,OAAOqB,EAAP,CAAU0G,OAAzC,CAAR;AACA,6BAAKV,QAAL,GAAgB,EAAhB;AACA,6BAAKA,QAAL,CAAcC,IAAd,CAAmBpH,GAAGqH,CAAH,CAAKA,EAAEtC,CAAP,EAASsC,EAAErC,CAAX,CAAnB;AACAlF,+BAAOqB,EAAP,CAAUqD,MAAV,CAAiB4C,IAAjB,CAAsBpH,GAAGqH,CAAH,CAAKA,CAAL,CAAtB;AACA,6BAAKnB,QAAL,GAAgBmB,CAAhB;AACAvH,+BAAOqB,EAAP,CAAU0G,OAAV,GAAoB,IAApB;AACH;AACJ;AACD,oBAAG/H,OAAOqB,EAAP,CAAUsF,MAAb,EAAoB;AAChB,wBAAIqB,MAAMP,WAAW,CAAX,EAAcQ,KAAxB;AACA,wBAAIC,QAAQ,KAAKrB,IAAL,CAAUC,oBAAV,CAA+B,KAAKhG,MAAL,CAAYiG,MAAZ,CAAmBC,qBAAnB,CAAyCgB,GAAzC,CAA/B,CAAZ;AACH,iBAHD,MAGK;AACD,wBAAIE,QAAQrD,EAAZ;AACH;AACD;AACA;AACA;AACA,oBAAIC,IAAIC,KAAKC,IAAL,CAAU,CAACJ,GAAGK,CAAH,GAAKiD,MAAMjD,CAAZ,KAAgBL,GAAGK,CAAH,GAAKiD,MAAMjD,CAA3B,IAAgC,CAACL,GAAGM,CAAH,GAAKgD,MAAMhD,CAAZ,KAAgBN,GAAGM,CAAH,GAAKgD,MAAMhD,CAA3B,CAA1C,CAAR;AACA,qBAAKxC,UAAL,IAAmBoC,CAAnB;AACA,qBAAK5B,SAAL,GAAiBC,SAAS,CAAC,IAAG,KAAKT,UAAL,GAAgB,KAAKnC,SAAzB,IAAqC,GAA9C,CAAjB;AACA,oBAAG,KAAK2C,SAAL,IAAkB,CAArB,EAAuB;AACnB,yBAAKA,SAAL,GAAiB,CAAjB;AACA;AACA;AACA;AACAlD,2BAAOqB,EAAP,CAAUqF,MAAV,GAAmB,KAAnB;AACA,yBAAK3F,GAAL,CAASQ,MAAT,GAAkB,KAAlB;AACA,yBAAK8C,QAAL;AACH;AACD,qBAAKtB,KAAL,CAAWK,MAAX,GAAoB,KAAKF,SAAL,GAAiB,GAArC;AACAlD,uBAAOqB,EAAP,CAAU0B,KAAV,GAAkB,KAAKG,SAAvB;AACA,qBAAKI,YAAL,CAAkBC,KAAlB,GAA0B,KAAKF,YAAL,IAAmB,KAAKH,SAAL,GAAe,GAAlC,CAA1B;AACA,qBAAKiF,MAAL;AACA,oBAAG,KAAKd,QAAL,CAAc1C,MAAd,GAAqB,CAAxB,EAA0B;AACtB,yBAAKyD,YAAL,CAAkB,CAAClI,GAAGqH,CAAH,CAAK,EAACtC,GAAEL,GAAGK,CAAH,GAAK,CAAR,EAAUC,GAAEN,GAAGM,CAAH,GAAK,CAAjB,EAAL,CAAD,EAA2BhF,GAAGqH,CAAH,CAAK,EAACtC,GAAEiD,MAAMjD,CAAN,GAAQ,CAAX,EAAaC,GAAEgD,MAAMhD,CAAN,GAAQ,CAAvB,EAAL,CAA3B,CAAlB;AACA,yBAAKkD,YAAL,CAAkB,KAAKf,QAAvB;AACA,yBAAKA,QAAL,GAAgB,EAAhB;AACH;AACD,oBAAGrH,OAAOkB,EAAP,CAAUmH,YAAV,CAAuBC,SAAvB,IAAoC,KAAvC,EAA6C;AACzCtI,2BAAOkB,EAAP,CAAUqH,eAAV,CAA0BvI,OAAOkB,EAAP,CAAUsH,WAApC;AACH;AACD,oBAAG,KAAKnB,QAAL,CAAc1C,MAAd,IAAwB,CAA3B,EAA6B;AACzB,wBAAI8D,SAAS,KAAKpB,QAAL,CAAc,CAAd,CAAb;AACA,wBAAIqB,QAAQ3D,KAAKC,IAAL,CAAU,CAACyD,OAAOxD,CAAP,GAASiD,MAAMjD,CAAhB,KAAoBwD,OAAOxD,CAAP,GAASiD,MAAMjD,CAAnC,IAAwC,CAACwD,OAAOvD,CAAP,GAASgD,MAAMhD,CAAhB,KAAoBuD,OAAOvD,CAAP,GAASgD,MAAMhD,CAAnC,CAAlD,CAAZ;AACA,wBAAGwD,QAAQ,CAAX,EAAa;AACT,6BAAKrB,QAAL,CAAcC,IAAd,CAAmBpH,GAAGqH,CAAH,CAAKW,KAAL,CAAnB;AACH;AACJ,iBAND,MAMK;AACD,yBAAKb,QAAL,CAAcC,IAAd,CAAmBpH,GAAGqH,CAAH,CAAKW,KAAL,CAAnB;AACH;AACDlI,uBAAOqB,EAAP,CAAUqD,MAAV,CAAiB4C,IAAjB,CAAsBpH,GAAGqH,CAAH,CAAKW,KAAL,CAAtB;AACA,qBAAK1E,QAAL,CAAcwC,WAAd,GAA4B9F,GAAG+F,UAAH,CAAc,SAAd,CAA5B;AACA,qBAAKzC,QAAL,CAAc6C,MAAd,CAAqB6B,MAAMjD,CAA3B,EAA8BiD,MAAMhD,CAApC;AACA,qBAAK1B,QAAL,CAAc8C,MAAd;AACA,qBAAK9C,QAAL,CAAc2C,MAAd,CAAqB+B,MAAMjD,CAA3B,EAA8BiD,MAAMhD,CAApC;AACH,aA/DD,MA+DK;AACD,qBAAK1B,QAAL,CAAcwC,WAAd,GAA4B9F,GAAG+F,UAAH,CAAc,SAAd,CAA5B;AACA,qBAAKzC,QAAL,CAAc6C,MAAd,CAAqBxB,GAAGI,CAAxB,EAA2BJ,GAAGK,CAA9B;AACA,qBAAK1B,QAAL,CAAc8C,MAAd;AACA,qBAAK9C,QAAL,CAAc2C,MAAd,CAAqBtB,GAAGI,CAAxB,EAA2BJ,GAAGK,CAA9B;AACH;AAIJ;AAEJ,KA3UI;;AA4UL;AACAb,YA7UK,sBA6UK;AACN;AACA;;AAEA,aAAK+D,YAAL,CAAkB,KAAKf,QAAvB;AACA,aAAK5B,WAAL,CAAiBzF,OAAOqB,EAAP,CAAUqD,MAA3B;AACA,aAAK3D,GAAL,CAASQ,MAAT,GAAkB,KAAlB;AACA,aAAKiC,QAAL,CAAcmF,KAAd;AACA3I,eAAOqB,EAAP,CAAUqD,MAAV,GAAmB,EAAnB;AACA,aAAKF,QAAL,GAAgB,EAAhB;AACA,aAAK6C,QAAL,GAAgB,EAAhB;AACA,aAAKrF,YAAL,CAAkBtB,IAAlB,GAAyBR,GAAGyF,aAAH,CAAiBC,OAA1C;AACA,aAAK1D,aAAL,CAAmBxB,IAAnB,GAA0BR,GAAGyF,aAAH,CAAiBC,OAA3C;AACH,KA1VI;;;AA4VL;AACAuC,UA7VK,oBA6VG;AACJ,YAAG,KAAKvF,aAAR,EAAsB;AAClB,gBAAG,KAAKM,SAAL,IAAkBlD,OAAOqB,EAAP,CAAUuH,SAA/B,EAAyC;AACrC,qBAAKC,QAAL,CAAc,KAAKrI,UAAnB;AACA,qBAAKoC,aAAL,GAAqB,KAArB;AACH;AACJ;AACD,YAAG,KAAKC,aAAR,EAAsB;AAClB,gBAAG,KAAKK,SAAL,IAAkBlD,OAAOqB,EAAP,CAAUyH,SAA/B,EAAyC;AACrC,qBAAKD,QAAL,CAAc,KAAKjI,UAAnB;AACA,qBAAKiC,aAAL,GAAqB,KAArB;AACH;AACJ;AACD,YAAG,KAAKC,aAAR,EAAsB;AAClB,gBAAG,KAAKI,SAAL,IAAkBlD,OAAOqB,EAAP,CAAU0H,SAA/B,EAAyC;AACrC,qBAAKF,QAAL,CAAc,KAAKrI,UAAnB;AACA,qBAAKsC,aAAL,GAAqB,KAArB;AACH;AACJ;AAEJ,KAjXI;;AAkXL;AACA+F,YAnXK,oBAmXIG,IAnXJ,EAmXS;AACV,YAAIC,MAAMD,KAAKhG,YAAL,CAAkB9C,GAAGgH,SAArB,CAAV;AACA+B,YAAIrF,EAAJ,CAAO,UAAP,EAAoB,YAAU;AAC1B,gBAAIsF,WAAWhJ,GAAG2B,WAAH,CAAe7B,OAAOqB,EAAP,CAAU8H,cAAzB,CAAf;AACAD,qBAASjE,CAAT,GAAa+D,KAAK/D,CAAlB;AACAiE,qBAAShE,CAAT,GAAa8D,KAAK9D,CAAlB;AACA8D,iBAAKjC,MAAL,CAAYhF,QAAZ,CAAqBmH,QAArB;AACH,SALD,EAKE,IALF;AAMAD,YAAI7B,IAAJ;AACH,KA5XI;AA+XLgC,iBA/XK,yBA+XSC,EA/XT,EA+XaC,EA/Xb,EA+XiB;;AAElB,eAAOvE,KAAKwE,KAAL,CAAWD,EAAX,EAAeD,EAAf,IAAqB,GAArB,GAA2BtE,KAAKyE,EAAvC;AAEH,KAnYI;;;AAqYL;;AAEAC,qBAvYK,6BAuYaC,MAvYb,EAuYqBC,MAvYrB,EAuY6BC,IAvY7B,EAuYmCC,IAvYnC,EAuYyC;;AAE1C,YAAIP,KAAKO,OAAOF,MAAhB;;AAEA,YAAIN,KAAKO,OAAOF,MAAhB;;AAEA,YAAII,SAAS,CAAb;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA,YAAIC,QAAQ,KAAKX,aAAL,CAAmBC,EAAnB,EAAuBC,EAAvB,CAAZ;;AAEA,YAAGS,SAAS,CAAC,EAAV,IAAgBA,QAAQ,EAA3B,EAA+B;;AAE3BD,qBAAS,CAAT;AAEH,SAJD,MAIM,IAAIC,SAAS,EAAT,IAAeA,QAAQ,GAA3B,EAAgC;;AAElCD,qBAAS,CAAT;AAEH,SAJK,MAIA,IAAIC,SAAS,CAAC,GAAV,IAAiBA,QAAQ,CAAC,EAA9B,EAAkC;;AAEpCD,qBAAS,CAAT;AAEH,SAJK,MAMD,IAAKC,SAAS,GAAT,IAAgBA,SAAS,GAA1B,IAAmCA,SAAS,CAAC,GAAV,IAAiBA,QAAQ,CAAC,GAAjE,EAAuE;;AAExED,qBAAS,CAAT;AAEH;;AAED,eAAOA,MAAP;AAEH,KA/aI;;;AAibL;AACA1B,gBAlbK,wBAkbQf,QAlbR,EAkbiB;AAClB,YAAI2C,OAAO,CAAX;AACA,YAAIC,OAAO,CAAX;AACA,YAAIC,MAAM,CAAV;AACA,YAAIC,MAAM,CAAV;;AAEA,YAAG9C,SAAS1C,MAAT,GAAkB,CAArB,EAAuB;AACnB,gBAAIC,KAAKyC,SAAS,CAAT,CAAT;AACA,gBAAIxC,KAAKwC,SAASA,SAAS1C,MAAT,GAAgB,CAAzB,CAAT;AACA,gBAAIG,IAAIC,KAAKC,IAAL,CAAU,CAACJ,GAAGK,CAAH,GAAKJ,GAAGI,CAAT,KAAaL,GAAGK,CAAH,GAAKJ,GAAGI,CAArB,IAA0B,CAACL,GAAGM,CAAH,GAAKL,GAAGK,CAAT,KAAaN,GAAGM,CAAH,GAAKL,GAAGK,CAArB,CAApC,CAAR;AACA,gBAAGJ,IAAI,CAAP,EAAS;AACL;AACA,qBAAKP,SAAL,GAAiB,KAAKkF,iBAAL,CAAuB7E,GAAGK,CAA1B,EAA4BL,GAAGM,CAA/B,EAAiCL,GAAGI,CAApC,EAAsCJ,GAAGK,CAAzC,CAAjB;AACA,oBAAG,KAAKX,SAAL,IAAkB,CAAlB,IAAuB,KAAKA,SAAL,IAAkB,CAA5C,EAA8C;AAAC;AAC3CyF,2BAAO,CAAP;AACAE,0BAAM,CAAC,CAAP;AACH;AACD,oBAAG,KAAK3F,SAAL,IAAkB,CAAlB,IAAuB,KAAKA,SAAL,IAAkB,CAA5C,EAA8C;AAAC;AAC3C0F,2BAAO,CAAC,CAAR;AACAE,0BAAM,CAAN;AACH;;AAGD,qBAAK,IAAIjE,IAAImB,SAAS1C,MAAT,GAAgB,CAA7B,EAAgCuB,KAAK,CAArC,EAAwCA,GAAxC,EAA6C;AACzCmB,6BAASnB,CAAT,EAAYhB,CAAZ,IAAiBiF,GAAjB;AACA9C,6BAASnB,CAAT,EAAYjB,CAAZ,IAAiBiF,GAAjB;AACH;AACD;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAK,IAAIhE,IAAImB,SAAS1C,MAAT,GAAgB,CAA7B,EAAgCuB,KAAK,CAArC,EAAwCA,GAAxC,EAA6C;AACzC,wBAAIhB,IAAImC,SAASnB,CAAT,EAAYhB,CAAZ,GAAgB+E,IAAxB;AACA,wBAAIhF,IAAIoC,SAASnB,CAAT,EAAYjB,CAAZ,GAAgB+E,IAAxB;AACA3C,6BAASC,IAAT,CAAcpH,GAAGqH,CAAH,CAAK,EAACtC,IAAD,EAAKC,IAAL,EAAL,CAAd;AACH;AACD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,qBAAKV,QAAL,CAAc8C,IAAd,CAAmBD,QAAnB;AACA;AACA;AACH;AACJ;AAGJ;AAhfI;;AAkfL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;AApgBJ","file":"lb_ysc_graphics.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\lb_ysc\\Script","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\r\n\r\n\r\nvar common = require('lb_ysc_common');\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        maxLenght:0,\r\n        scor_star1:{//分数星星1\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        scor_star2:{//分数星星2\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        scor_star3:{//分数星星3\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        Canvas:{\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        pen:{\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        score_text:{\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        score_text:{\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        schedule_bar:{\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        //common.gm.loadLevel(common.sm.levelIndex);\r\n        this.maxLenght = common.sm.maxLenght;\r\n        \r\n    },\r\n    start () {\r\n        //加载关卡\r\n        var index = common.gm.level;\r\n        if(index == 1){\r\n            this.pen.active = true;\r\n        }\r\n        var url = \"lb_ysc/levels/lb_ysc_level\"+index;\r\n        cc.loader.loadRes(url, (err, prefab)=> {\r\n            if(prefab){\r\n                var level = cc.instantiate(prefab);\r\n                common.gm.level_node.addChild(level);\r\n                common.gm.boyRigidBody = level.getChildByName('boy');\r\n                common.gm.grilRigidBody = level.getChildByName('gril');\r\n                common.gm.gameTip = level.getChildByName('tip');\r\n                this.init();\r\n            }\r\n        });\r\n        \r\n        \r\n    },\r\n\r\n    update (dt) {\r\n        \r\n        if(this.pen_speed > 0){\r\n        \r\n            this.pen_speed--;\r\n            if(this.pen_speed < 0){\r\n                this.pen_speed = 0;\r\n            }\r\n            if(this.penState)\r\n            this.penState.speed = this.pen_speed;\r\n        }\r\n    },\r\n    init(){\r\n        this.drawLenght = 0;\r\n\r\n        this.event_id = null;\r\n        this.is_scor_star1 = true;\r\n        this.is_scor_star2 = true;\r\n        this.is_scor_star3 = true;\r\n        //画笔速度\r\n        this.pen_speed = 0;\r\n        //分数\r\n        this.score = this.score_text.getComponent(cc.Label);\r\n        this.score_val = parseInt(this.score.string);\r\n        //进度\r\n        this.schedule_val = this.schedule_bar.width;\r\n        //.绘图组件\r\n        this.graphics = this.getComponent(cc.Graphics);\r\n\r\n        \r\n        this.boyRigidBody = common.gm.boyRigidBody.getComponent(cc.RigidBody);\r\n        this.grilRigidBody = common.gm.grilRigidBody.getComponent(cc.RigidBody);\r\n        this.boyRigidBody.gravityScale = 5;\r\n        this.grilRigidBody.gravityScale = 5;\r\n\r\n        //.触摸事件\r\n        this.event_id = common.sm.event_id;\r\n        this.Canvas.on(cc.Node.EventType.TOUCH_START,this.touchStar,this);\r\n        this.Canvas.on(cc.Node.EventType.TOUCH_MOVE,this.touchMove,this);\r\n        this.Canvas.on(cc.Node.EventType.TOUCH_END,function(event){\r\n            this.pen.active = false;\r\n            // if(common.gm.isStop == false){\r\n            //     var p2 = this.node.convertToNodeSpaceAR(this.Canvas.parent.convertToWorldSpaceAR(event.getLocation()));\r\n            //     this.curpoint.push(cc.p(p2));\r\n            // }\r\n            //if(this.event_id != event.getID()){return;}\r\n            if(this.event_id != event.getID()){\r\n                return;\r\n            }\r\n            this.event_id = null;\r\n            this.touchEnd();\r\n        },this);\r\n        this.Canvas.on(cc.Node.EventType.TOUCH_CANCEL,function(event){\r\n            this.pen.active = false;\r\n            // if(common.gm.isStop == false){\r\n            //     var p2 = this.node.convertToNodeSpaceAR(this.Canvas.parent.convertToWorldSpaceAR(event.getLocation()));\r\n            //     this.curpoint.push(cc.p(p2));\r\n            // }\r\n            //if(this.event_id != event.getID()){return;}\r\n            if(this.event_id != event.getID()){\r\n                return;\r\n            }\r\n            this.event_id = null;\r\n            this.touchEnd();\r\n        },this);\r\n\r\n        this.direction = 0;//方向\r\n        //分段数组pointbox\r\n        this.pointbox = [];\r\n        \r\n    },\r\n\r\n\r\n\r\n    addPolygonCollider(points){\r\n        if(points.length > 1){\r\n            try{\r\n                var p1 = points[0];\r\n                var p2 = points[points.length-1];\r\n                var d = Math.sqrt((p1.x-p2.x)*(p1.x-p2.x) + (p1.y-p2.y)*(p1.y-p2.y));\r\n                if(d>4){\r\n                    var p_collider = this.boxNode.addComponent(cc.PhysicsPolygonCollider);//.PhysicsChainCollider\r\n                    p_collider.points = points;\r\n                    p_collider.apply();\r\n                }\r\n            }catch(e){\r\n\r\n            }\r\n            \r\n        }\r\n        \r\n    },\r\n\r\n    addCollider(points){\r\n        if(this.pointbox.length > 0){\r\n            this.boxNode = new cc.Node();\r\n            var rigidbody = this.boxNode.addComponent(cc.RigidBody);\r\n            rigidbody.type = cc.RigidBodyType.Dynamic;\r\n            rigidbody.gravityScale = 10;\r\n    \r\n           \r\n            // var collider = this.boxNode.addComponent(cc.PhysicsPolygonCollider);//.PhysicsChainCollider\r\n            // collider.points = points2;\r\n            // collider.apply();\r\n            if(this.pointbox){\r\n                this.pointbox.forEach((element,index) => {\r\n                    this.addPolygonCollider(element);\r\n                });\r\n            }\r\n            \r\n            var graphics = this.boxNode.addComponent(cc.Graphics);\r\n            graphics.lineWidth = 6;\r\n            graphics.strokeColor = cc.hexToColor('#0000ff');\r\n            \r\n            for(var i=0; i<points.length; i++){\r\n                if(i == 0){\r\n                    graphics.moveTo(this.startPos.x, this.startPos.y);\r\n                }\r\n                graphics.lineTo(points[i].x, points[i].y);\r\n                \r\n            }\r\n            graphics.stroke();\r\n            this.boxNode.group = \"lb_ysc_line\";\r\n            common.gm.level_node.addChild(this.boxNode);\r\n            this.pointbox = [];\r\n        }\r\n\r\n\r\n    \r\n        \r\n    },\r\n    \r\n\r\n    //绘制开始\r\n    touchStar(event){\r\n        console.log(\"touchStar:\",event.getID());\r\n        if(this.event_id == null){\r\n            this.event_id = event.getID();\r\n        }else{\r\n            if(this.event_id != event.getID()){\r\n                return;\r\n            }\r\n        }\r\n        //if(this.event_id != event.getID()){return;}\r\n        \r\n        if(common.gm.isDraw){\r\n            common.gm.isStop = false;\r\n            this.graphics.strokeColor = new cc.Color(0,0,0);\r\n            this.startPos = this.node.convertToNodeSpaceAR(this.Canvas.parent.convertToWorldSpaceAR(event.getLocation()));\r\n            \r\n            this.pen.x = this.startPos.x;\r\n            this.pen.y = this.startPos.y;\r\n            this.pen.active = true;\r\n            common.gm.gameTip.active = false;\r\n            this.pen.getComponent(cc.Animation).stop();\r\n            this.penState = this.pen.getComponent(cc.Animation).play(\"lb_ysc_penAnim\");\r\n            common.gm.points = [];\r\n            //临时点数组\r\n            this.curpoint = [];\r\n            this.curpoint.push(cc.p(this.startPos.x,this.startPos.y));\r\n            this.graphics.moveTo(this.startPos.x, this.startPos.y);\r\n            \r\n        }\r\n        \r\n    },\r\n\r\n    //绘制中\r\n    touchMove(event){\r\n        //if(this.event_id != event.getID()){return;}\r\n        //if(event._touches.length>1){return;}\r\n        if(this.event_id != event.getID()){\r\n            return;\r\n        }\r\n        if(common.gm.isDraw){\r\n            var p1 = this.node.convertToNodeSpaceAR(this.Canvas.parent.convertToWorldSpaceAR(event.getPreviousLocation()));\r\n            var p2 = this.node.convertToNodeSpaceAR(this.Canvas.parent.convertToWorldSpaceAR(event.getLocation()));\r\n            \r\n            //画笔跟随\r\n            this.pen.x = p2.x;\r\n            this.pen.y = p2.y;\r\n\r\n            \r\n            \r\n            \r\n            \r\n            if(this.pen_speed<2){\r\n                this.pen_speed+=2;\r\n            }\r\n            \r\n            \r\n            if(common.gm.isStop == false){\r\n                var rayresults = cc.director.getPhysicsManager().rayCast(cc.p(this.Canvas.parent.convertToWorldSpaceAR(event.getPreviousLocation())),\r\n                 cc.p(this.Canvas.parent.convertToWorldSpaceAR(event.getLocation())), cc.RayCastType.Any);\r\n                //var cur_dir = this.GetSlideDirection(p1.x, p1.y, p2.x, p2.y);\r\n                if(rayresults.length > 0){\r\n                    common.gm.isStop = true;\r\n                }else{\r\n                    if(common.gm.objOutP){\r\n                        var p = this.node.convertToNodeSpaceAR(common.gm.objOutP);\r\n                        this.curpoint = [];\r\n                        this.curpoint.push(cc.p(p.x,p.y));\r\n                        common.gm.points.push(cc.p(p));\r\n                        this.startPos = p;\r\n                        common.gm.objOutP = null;\r\n                    }\r\n                }\r\n                if(common.gm.isStop){\r\n                    var ray = rayresults[0].point;\r\n                    var cur_p = this.node.convertToNodeSpaceAR(this.Canvas.parent.convertToWorldSpaceAR(ray));\r\n                }else{\r\n                    var cur_p = p2;\r\n                }\r\n                // if(this.direction == 0){\r\n                //     this.direction = cur_dir;\r\n                // }\r\n                var d = Math.sqrt((p1.x-cur_p.x)*(p1.x-cur_p.x) + (p1.y-cur_p.y)*(p1.y-cur_p.y));\r\n                this.drawLenght += d;\r\n                this.score_val = parseInt((1-(this.drawLenght/this.maxLenght))*100);\r\n                if(this.score_val <= 0){\r\n                    this.score_val = 0;\r\n                    //游戏结束\r\n                    // cc.director.getPhysicsManager().enabled = false;\r\n                    // common.gm.lose();\r\n                    common.gm.isDraw = false;\r\n                    this.pen.active = false;\r\n                    this.touchEnd();\r\n                }\r\n                this.score.string = this.score_val + \"%\";\r\n                common.gm.score = this.score_val;\r\n                this.schedule_bar.width = this.schedule_val*(this.score_val/100);\r\n                this.starUp();\r\n                if(this.curpoint.length>1){\r\n                    this.incisionLine([cc.p({x:p1.x+1,y:p1.y+1}),cc.p({x:cur_p.x+1,y:cur_p.y+1})]);\r\n                    this.incisionLine(this.curpoint);\r\n                    this.curpoint = [];\r\n                }\r\n                if(common.sm.audio_effect.isPlaying == false){\r\n                    common.sm.audioEffectPlay(common.sm.audio_write);\r\n                }\r\n                if(this.curpoint.length == 1){\r\n                    var cur_p1 = this.curpoint[0];\r\n                    var cur_d = Math.sqrt((cur_p1.x-cur_p.x)*(cur_p1.x-cur_p.x) + (cur_p1.y-cur_p.y)*(cur_p1.y-cur_p.y));\r\n                    if(cur_d > 3){\r\n                        this.curpoint.push(cc.p(cur_p));\r\n                    }\r\n                }else{\r\n                    this.curpoint.push(cc.p(cur_p));\r\n                }\r\n                common.gm.points.push(cc.p(cur_p));\r\n                this.graphics.strokeColor = cc.hexToColor('#000000');\r\n                this.graphics.lineTo(cur_p.x, cur_p.y);\r\n                this.graphics.stroke();\r\n                this.graphics.moveTo(cur_p.x, cur_p.y);\r\n            }else{\r\n                this.graphics.strokeColor = cc.hexToColor('#ff0000');\r\n                this.graphics.lineTo(p2.x, p2.y);\r\n                this.graphics.stroke();\r\n                this.graphics.moveTo(p2.x, p2.y);\r\n            }\r\n            \r\n            \r\n\r\n        }\r\n        \r\n    },\r\n    //绘制结束\r\n    touchEnd(){\r\n        // this.points.push(this.startPos)\r\n        // this.addPolygonCollider(this.points)\r\n        \r\n        this.incisionLine(this.curpoint);\r\n        this.addCollider(common.gm.points);\r\n        this.pen.active = false;\r\n        this.graphics.clear();\r\n        common.gm.points = [];\r\n        this.pointbox = [];\r\n        this.curpoint = [];\r\n        this.boyRigidBody.type = cc.RigidBodyType.Dynamic;\r\n        this.grilRigidBody.type = cc.RigidBodyType.Dynamic;\r\n    },\r\n\r\n    //星星更新\r\n    starUp(){\r\n        if(this.is_scor_star1){\r\n            if(this.score_val <= common.gm.get_star3){\r\n                this.starHide(this.scor_star1);\r\n                this.is_scor_star1 = false;\r\n            }\r\n        }\r\n        if(this.is_scor_star2){\r\n            if(this.score_val <= common.gm.get_star2){\r\n                this.starHide(this.scor_star2);\r\n                this.is_scor_star2 = false;\r\n            }\r\n        }\r\n        if(this.is_scor_star3){\r\n            if(this.score_val <= common.gm.get_star1){\r\n                this.starHide(this.scor_star1);\r\n                this.is_scor_star3 = false;\r\n            }\r\n        }\r\n        \r\n    },\r\n    //星星消散\r\n    starHide(star){\r\n        var ani = star.getComponent(cc.Animation);\r\n        ani.on('finished',  function(){\r\n            var star_low = cc.instantiate(common.gm.star_lowPrefab);\r\n            star_low.x = star.x;\r\n            star_low.y = star.y;\r\n            star.parent.addChild(star_low);\r\n        },this);\r\n        ani.play();\r\n    },\r\n\r\n\r\n    GetSlideAngle(dx, dy) { \r\n\r\n        return Math.atan2(dy, dx) * 180 / Math.PI; \r\n\r\n    }, \r\n\r\n    //根据起点和终点返回方向 1：向上，2：向下，3：向左，4：向右,0：未滑动 \r\n\r\n    GetSlideDirection(startX, startY, endX, endY) { \r\n\r\n        var dy = endY - startY; \r\n\r\n        var dx = endX - startX; \r\n\r\n        var result = 0;   \r\n\r\n        //如果滑动距离太短 \r\n\r\n        // if(Math.abs(dx) < 1 && Math.abs(dy) < 1) { \r\n\r\n        //     return this.direction; \r\n\r\n        // } \r\n\r\n        var angle = this.GetSlideAngle(dx, dy); \r\n\r\n        if(angle >= -45 && angle < 45) { \r\n\r\n            result = 4; \r\n\r\n        }else if (angle >= 45 && angle < 135) { \r\n\r\n            result = 1; \r\n\r\n        }else if (angle >= -135 && angle < -45) { \r\n\r\n            result = 2; \r\n\r\n        } \r\n\r\n        else if ((angle >= 135 && angle <= 180) || (angle >= -180 && angle < -135)) { \r\n\r\n            result = 3; \r\n\r\n        } \r\n\r\n        return result; \r\n\r\n    },\r\n\r\n    //分段切割并做包围盒子\r\n    incisionLine(curpoint){\r\n        var addx = 0;\r\n        var addy = 0;\r\n        var rex = 0;\r\n        var rey = 0;\r\n        \r\n        if(curpoint.length > 1){\r\n            var p1 = curpoint[0];\r\n            var p2 = curpoint[curpoint.length-1];\r\n            var d = Math.sqrt((p1.x-p2.x)*(p1.x-p2.x) + (p1.y-p2.y)*(p1.y-p2.y));\r\n            if(d > 2){\r\n                //var next_p = curpoint[curpoint.length-1];\r\n                this.direction = this.GetSlideDirection(p1.x,p1.y,p2.x,p2.y);\r\n                if(this.direction == 1 || this.direction == 2){//竖线\r\n                    addx = 6;\r\n                    rex = -3;\r\n                }\r\n                if(this.direction == 3 || this.direction == 4){//横线\r\n                    addy = -6;\r\n                    rey = 3;\r\n                }\r\n\r\n                \r\n                for( var i = curpoint.length-1; i >= 0; i-- ){\r\n                    curpoint[i].y += rey;\r\n                    curpoint[i].x += rex;\r\n                }\r\n                //点的剔除\r\n                \r\n                // for(var i=0; i<curpoint.length; i++){\r\n                //     if(i != 0 && i!=curpoint.length){\r\n                //         var n_p = curpoint[i-1];\r\n                //         var t_p = curpoint[i];\r\n                //         var d = Math.sqrt((n_p.x-t_p.x)*(n_p.x-t_p.x) + (n_p.y-t_p.y)*(n_p.y-t_p.y));\r\n                //         if(d < 0.5){\r\n                //             curpoint.splice(i,1);\r\n                //         }\r\n                //     }\r\n                // }\r\n                //封边操作\r\n                for( var i = curpoint.length-1; i >= 0; i-- ){\r\n                    var y = curpoint[i].y + addy;\r\n                    var x = curpoint[i].x + addx;\r\n                    curpoint.push(cc.p({x , y}));\r\n                }\r\n                // for(var i=0; i<curpoint.length; i++){\r\n                //     if(i != 0){\r\n                //         var n_p = curpoint[i-1];\r\n                //         var t_p = curpoint[i];\r\n                        \r\n                //         if(t_p == t_p){\r\n                //             curpoint.splice(i,1);\r\n                //         } \r\n                //     }\r\n                // }\r\n                this.pointbox.push(curpoint);\r\n                //this.curpoint = [];\r\n                //this.curpoint.push(next_p);\r\n            }\r\n        }\r\n        \r\n        \r\n    },\r\n\r\n    //中间补点\r\n    // additional(){\r\n    //     if(this.pointbox.length>2){\r\n    //         var newAttr = this.pointbox.slice(0,this.pointbox.length);\r\n    //         for(var i=0; i<this.pointbox.length; i++){\r\n    //             if(i != this.pointbox.length-1){\r\n    //                 var t = this.pointbox[i];\r\n    //                 var n = this.pointbox[i+1];\r\n    //                 if(t.length > 2 && n.length >2){\r\n    //                     var star = t[t.length];\r\n    //                     var end = n[0];\r\n    //                     newAttr.splice(i,0,[star,end]);\r\n    //                 }\r\n    //             }\r\n    //         }\r\n    //         this.pointbox = newAttr;\r\n    //     }\r\n        \r\n    // },\r\n\r\n\r\n});\r\n"]}